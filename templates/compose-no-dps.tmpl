{{{define "dps"}}}
    traefik:
        ports:
            - "8081:8080"
            - {{{get . "PUBLIC_HTTP_PORT"}}}:80
            - {{{get . "PUBLIC_HTTPS_PORT"}}}:443
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - {{{get . "CBD_CERT_ROOT_PATH"}}}/traefik:/certs/traefik
            - ./logs/traefik:/opt/traefik/log/
            - ./traefik.toml:/etc/traefik/traefik.toml
        networks:
        - {{{get . "DOCKER_NETWORK_NAME"}}}
        logging:
            options:
                max-size: "10M"
                max-file: "5"
        image: traefik:{{{get . "DOCKER_TAG_TRAEFIK"}}}
        restart: on-failure
        command: --debug --api --rest --ping --metrics --InsecureSkipVerify=true --defaultEntryPoints=http,https --entryPoints='Name:http Address::80 Redirect.EntryPoint:https' --entryPoints='Name:https Address::443 TLS:{{{get . "CBD_TRAEFIK_TLS"}}}' --maxidleconnsperhost={{{get . "TRAEFIK_MAX_IDLE_CONNECTION"}}} --traefiklog.filepath=/opt/traefik/log/traefik.log --accessLog.filePath=/opt/traefik/log/access.log --docker
    
    caas-api:
        image: {{{get . "DOCKER_IMAGE_CAAS_MOCK"}}}:{{{get . "DOCKER_TAG_CAAS_MOCK"}}}
        restart: on-failure
        volumes:
        - {{{get . "CAAS_MOCK_VOLUME_HOST"}}}:{{{get . "CAAS_MOCK_VOLUME_CONTAINER"}}}
        networks:
        - {{{get . "DOCKER_NETWORK_NAME"}}}
        ports:
        - "{{{get . "CAAS_MOCK_BIND_PORT"}}}:8080"
        labels:
        - traefik.frontend.priority=100
        - traefik.frontend.rule=PathPrefix:/auth,/oidc,/idp,/caas
        - traefik.port=8080
        - traefik.backend=caas-backend
{{{end}}}
